###############################################################################
#   @author         :   Mahasri Kalavala
#   @date           :   04/15/2017
#   @package        :   Device Tracker
#   @description    :   Device Tracker stuff
###############################################################################
homeassistant:
  customize:

    group.family:
      order: 1

device_tracker:
  - platform: owntracks
    max_gps_accuracy: 200
    waypoints: True

group:
  Family:
    entities:
      - device_tracker.suresh_suresh
      - device_tracker.mallika_mallika
      - device_tracker.srinika_srinika
      - device_tracker.hasika_hasika
      - device_tracker.suresh
      - device_tracker.mallika
      - device_tracker.srinika
      - device_tracker.hasika
      - device_tracker.ipad
    
automation:
###############################################################################
# Welcome Family Members
###############################################################################
  - alias: Welcome Family
    initial_state: true
    trigger:
      - platform: state
        entity_id:
          - device_tracker.mallika_mallika
          - device_tracker.suresh_suresh
          - device_tracker.srinika_srinika
          - device_tracker.hasika_hasika
        from: 'not_home'
        to: 'home'
        for: '00:02:00'
    action:
      - service: script.notify_me
        data_template:
          value1: >
            Welcome home, {{ trigger.entity_id.split('.')[1].split('_')[1] | title }}!
          value2: ""
      - service: script.voice_notify
        data_template:
          value1: "Welcome home, my dear {{ trigger.entity_id.split('.')[1].split('_')[1] | title }}."

###############################################################################
# Alert when every one is away
###############################################################################
  - alias: Alert when everyone is AWAY
    initial_state: true
    trigger:
      platform: state
      entity_id:
        - device_tracker.mallika_mallika
        - device_tracker.suresh_suresh
        - device_tracker.srinika_srinika
        - device_tracker.hasika_hasika      
      from: 'home'
      to: 'not_home'
    action:
      - service: script.notify_me
        data: {"value1":"Warning - No one's at home at the moment!!!", "value2":""}
